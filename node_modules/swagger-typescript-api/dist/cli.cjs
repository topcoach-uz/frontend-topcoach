#!/usr/bin/env node
'use strict';

var chunkB7E4I4GW_cjs = require('./chunk-B7E4I4GW.cjs');
var path = require('path');
var url = require('url');
var P = require('lodash');
var v = require('didyoumean');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var P__default = /*#__PURE__*/_interopDefault(P);
var v__default = /*#__PURE__*/_interopDefault(v);

var c=Symbol("root"),E=Symbol("skip"),q=["version","help"];var F=(e,t)=>{if(e==null||!Array.isArray(e))throw "args should be array";let n=e.slice();switch(t){case"electron":return process.defaultApp?n.slice(2):n.slice(1);case"user":return n;default:return n.slice(2)}};v__default.default.threshold=.5;var G=(e,t,n)=>{let s=F(e.args,e.from);return new Promise((r,i)=>{let{command:u,usageOptions:a,error:d}=_(t,s);if(d){i(new Error(d));return}!a.length&&u.name===c&&a.push(u.options.find(p=>p.flags.name==="help"));let l=a.filter(p=>p.operation);if(l.length){l[0].operation(),r({command:E,options:{}});return}else {let p="",g=(m,f)=>{if(m){let h=m.$data;if(!h.length&&!f.flags.value)return !f.flags.isNoFlag;if(f.flags.value)return f.flags.value.variadic?h.reduce((w,y)=>(w.push(...y.split(",").map(f.flags.value.formatter)),w),[]):f.flags.value.formatter(h[0]||f.default)}return f.default},$=u.options.reduce((m,f)=>{if(p)return m;let h=a.find(y=>y.flags.name===f.flags.name);if(!h&&f.required)return p=`required option '${f.flags.raw}' not specified`,m;let w=g(h,f);if(!f.operation){let y=f.internal||{};m[y.name||f.flags.name]=y.formatter?y.formatter(w):w;}return m},{});p?i(new Error(p)):r({command:u.name===c?null:u.name,options:$});}})},_=(e,t)=>{let n=null,s=[],r=null,i="",u=[];return t.forEach((a,d)=>{if(!i){if(d===0){if(n=e[a],!n&&!a.startsWith("-")){let l=v__default.default(a,e.keys());i=`unknown command ${a}${l?`
(Did you mean ${l} ?)`:""}`;}else n||(n=e[c]);n&&(u=n.options.reduce((l,p)=>[...l,...p.flags.keys],[]));}if(!i){if(a.startsWith("-")){let l=n.options.find(p=>p.flags.keys.includes(a));if(!l){let p=v__default.default(a,u);i=`unknown option ${a}${p?`
(Did you mean ${p} ?)`:""}`;}if(l){if(r&&r.flags.name===l.flags.name)return;let p=s.find(g=>g.flags.name===l.flags.name);p?r=p:(r={...l,$data:[]},s.push(r));}return}r&&r.$data.push(a);}}}),n=n||e[c],i?{command:null,usageOptions:[],error:i}:{command:n,usageOptions:s,error:i}};var A=e=>e.reduce((t,n)=>{let s=`${n.flags.keys.join(", ")}${n.flags.value?.raw?` ${n.flags.value?.raw}`:""}`,r=`${n.description||""}${n.default===void 0||n.flags.isNoFlag&&n.default===!0?"":` (default: ${typeof n.default=="string"?`"${n.default}"`:n.default})`}`;return s.length>t.maxLength&&(t.maxLength=s.length),t.options.push({flags:s,description:r}),t},{options:[],maxLength:0}),C=(e,t,n)=>e.map(s=>{let i=`${Array(n).fill(" ").join("")}${s.flags.padEnd(t," ")}  `,u=Array(i.length).fill(" ").join(""),a=s.description.split(`
`);return i+a.map((d,l)=>l===0?d:`
${u}${d}`).join("")}).join(`
`),V=(e,t)=>{let{options:n,maxLength:s}=A(e[c].options),{commands:r,maxLength:i}=P__default.default.filter(e,l=>l.name!==c).reduce((l,p)=>{let g=A(p.options),$=`${p.name}${g.length?" [options]":""}`,m=p.description,f=Math.max($.length,g.maxLength);return f>l.maxLength&&(l.maxLength=f),l.commands.push({description:m,name:$,options:g}),l},{commands:[],maxLength:s}),u=C(n,s,2),a=r.map(l=>{let p=`  ${l.name.padEnd(i," ")}    `,g=Array(p.length).fill(" ").join(""),$=l.description.split(`
`),m=C(l.options.options,i,4);return p+$.map((f,h)=>h===0?f:`
${g}${f}`).join("")+(m.length?`
${m}`:"")}).join(`
`),d=[u&&`Options:
${u}`,a&&`Commands:
${a}`].filter(Boolean).join(`

`);console.log(`Usage: ${[t.input.name,t.input.alias].filter(Boolean).join("|")}${u?" [options]":""}${a?" [command]":""}
${t.input.description&&`
${t.input.description}`}

${d}`);},B=(e,t,n)=>{if(n.name===c)return V(e,t);let{options:s,maxLength:r}=A(n.options),i=C(s,r,2),u=[i&&`Options:
${i}`].filter(Boolean).join(`

`);console.log(`Usage: ${t.input.name} ${n.name}${i?" [options]":""}
${n.description&&`
${n.description}`}

${u}`);};var S=e=>{console.log(e.input.version);};var H={number:e=>+e,numeric:e=>+e,str:e=>`${e}`,string:e=>`${e}`,bool:e=>!!e,boolean:e=>!!e},D=e=>{let t=null,n=[],s=null,r=e.includes("--no-"),i=P__default.default.compact(e.split(" ").map(a=>a.replace(/,/g,"")));for(let a of i)if(a.startsWith("-"))n.push(a);else if(s===null&&(a.startsWith("{")||a.startsWith("[")||a.startsWith("<"))){let d=a.replace(/[{[<>}\].]/g,""),l=a.includes("...");s={raw:a,variadic:l,name:d,formatter:H[d]||H.string};}let u=n.slice().sort((a,d)=>d.length-a.length)[0];return u!==""&&(t=P__default.default.camelCase((r?u.replace("--no-",""):u).replace(/(--?)/,""))),{isNoFlag:r,raw:e,name:t,keys:n,value:s}},x=e=>{let t=D(e.flags);return t.name?{required:!!e.required,description:`${e.description||""}`,default:e.default,flags:t,operation:e.operation,internal:e.internal}:(console.warn("invalid option",e),null)};var I=e=>{let t={},n=(r,{addVersion:i=!1,addHelp:u=!0}={})=>(t[r.name]={name:r.name,description:`${r.description||""}`,options:P__default.default.compact(r.options.map(x))},i&&t[r.name].options.unshift(x({flags:"-v, --version",description:"output the current version",operation:()=>S(s)})),u&&t[r.name].options.push(x({flags:"-h, --help",description:"display help for command",operation:()=>B(t,s,t[r.name])})),s),s={commands:t,input:e,addCommand:n,execute:r=>G(r,t)};n({name:c,options:[]},{addVersion:!1,addHelp:!1});for(let r of e.options){let i=x(r);if(!i)return;if(q.includes(i.name)){console.warn("reserved option",i.name);return}t[c].options.push(i);}t[c].options.unshift(x({flags:"-v, --version",description:"output the current version",operation:()=>S(s)})),t[c].options.push(x({flags:"-h, --help",description:"display help for command",operation:()=>B(t,s,t[c])}));for(let r of Object.entries(e.commands??{}))n(r);return s};var o=new chunkB7E4I4GW_cjs.d({}),b=new chunkB7E4I4GW_cjs.e({}),W=I({name:chunkB7E4I4GW_cjs.a.name,alias:"sta",version:chunkB7E4I4GW_cjs.a.version,description:`Generate api via swagger scheme.
Supports OA 3.0, 2.0, JSON, yaml.`,options:[{flags:"-p, --path <string>",description:"path/url to swagger scheme",required:!0},{flags:"-o, --output <string>",description:"output path of typescript api file",default:"./"},{flags:"-n, --name <string>",description:"name of output typescript api file",default:o.fileName},{flags:"-t, --templates <string>",description:"path to folder containing templates"},{flags:"-d, --default-as-success",description:`use "default" response status code as success response too.
some swagger schemas use "default" response status code as success response type by default.`,default:o.defaultResponseAsSuccess,internal:{name:"defaultResponseAsSuccess"}},{flags:"-r, --responses",description:`generate additional information about request responses
also add typings for bad responses`,default:o.generateResponses,internal:{name:"generateResponses"}},{flags:"--union-enums",description:'generate all "enum" types as union types (T1 | T2 | TN)',default:o.generateUnionEnums,internal:{name:"generateUnionEnums"}},{flags:"--add-readonly",description:"generate readonly properties",default:o.addReadonly},{flags:"--route-types",description:"generate type definitions for API routes",default:o.generateRouteTypes,internal:{name:"generateRouteTypes"}},{flags:"--no-client",description:"do not generate an API class",default:o.generateClient},{flags:"--enum-names-as-values",description:"use values in 'x-enumNames' as enum values (not only as keys)",default:o.enumNamesAsValues},{flags:"--extract-request-params",description:"extract request params to data contract (Also combine path params and query params into one object)",default:o.extractRequestParams,internal:{formatter:Boolean}},{flags:"--extract-request-body",description:"extract request body type to data contract",default:o.extractRequestBody,internal:{formatter:Boolean}},{flags:"--extract-response-body",description:"extract response body type to data contract",default:o.extractResponseBody,internal:{formatter:Boolean}},{flags:"--extract-response-error",description:"extract response error type to data contract",default:o.extractResponseError,internal:{formatter:Boolean}},{flags:"--extract-responses",description:"extract all responses described in /components/responses",default:o.extractResponses,internal:{formatter:Boolean}},{flags:"--modular",description:"generate separated files for http client, data contracts, and routes",default:o.modular,internal:{formatter:Boolean}},{flags:"--js",description:"generate js api module with declaration file",default:o.toJS,internal:{formatter:Boolean,name:"toJS"}},{flags:"--module-name-index <number>",description:"determines which path index should be used for routes separation (example: GET:/fruits/getFruit -> index:0 -> moduleName -> fruits)",default:o.moduleNameIndex,internal:{formatter:e=>+e||0}},{flags:"--module-name-first-tag",description:"splits routes based on the first tag",default:o.moduleNameFirstTag},{flags:"--disableStrictSSL",description:"disabled strict SSL",default:o.disableStrictSSL,internal:{formatter:Boolean}},{flags:"--disableProxy",description:"disabled proxy",default:o.disableProxy,internal:{formatter:Boolean}},{flags:"--axios",description:"generate axios http client",default:o.httpClientType===chunkB7E4I4GW_cjs.b.AXIOS},{flags:"--unwrap-response-data",description:"unwrap the data item from the response",default:o.unwrapResponseData},{flags:"--disable-throw-on-error",description:"Do not throw an error when response.ok is not true",default:o.disableThrowOnError},{flags:"--single-http-client",description:"Ability to send HttpClient instance to Api constructor",default:o.singleHttpClient,internal:{formatter:Boolean}},{flags:"--silent",description:"Output only errors to console",default:o.silent,internal:{formatter:Boolean}},{flags:"--default-response <type>",description:"default type for empty response schema",default:o.defaultResponseType,internal:{name:"defaultResponseType"}},{flags:"--type-prefix <string>",description:"data contract name prefix",default:o.typePrefix},{flags:"--type-suffix <string>",description:"data contract name suffix",default:o.typeSuffix},{flags:"--clean-output",description:"clean output folder before generate api. WARNING: May cause data loss",default:o.cleanOutput,internal:{formatter:Boolean}},{flags:"--api-class-name <string>",description:"name of the api class",default:o.apiClassName},{flags:"--patch",description:"fix up small errors in the swagger source definition",default:o.patch,internal:{formatter:Boolean}},{flags:"--debug",description:"additional information about processes inside this tool",default:o.debug},{flags:"--another-array-type",description:"generate array types as Array<Type> (by default Type[])",default:o.anotherArrayType},{flags:"--sort-types",description:"sort fields and types",default:o.sortTypes},{flags:"--extract-enums",description:"extract all enums from inline interface\\type content to typescript enum construction",default:o.extractEnums},{flags:"--sort-routes",description:"sort routes in alphabetical order",default:o.sortRoutes},{flags:"--custom-config <string>",description:"custom config: primitiveTypeConstructs, hooks, ... ",default:""}]});W.addCommand({name:"generate-templates",description:'Generate ".ejs" templates needed for generate api',options:[{flags:"-o, --output <string>",description:"output path of generated templates",default:b.output},{flags:"-m, --modular",description:"generate templates needed to separate files for http client, data contracts, and routes",default:b.modular,internal:{formatter:Boolean}},{flags:"--http-client <string>",description:`http client type (possible values: ${Object.values(chunkB7E4I4GW_cjs.b).map(e=>`"${e}"`).join(", ")})`,default:b.httpClientType,internal:{name:"httpClientType"}},{flags:"-c, --clean-output",description:"clean output folder before generate template. WARNING: May cause data loss",default:b.cleanOutput,internal:{formatter:Boolean}},{flags:"-r, --rewrite",description:"rewrite content in existing templates",default:b.rewrite,internal:{formatter:Boolean}},{flags:"--silent",description:"Output only errors to console",default:b.silent,internal:{formatter:Boolean}}]});var K=async()=>{let{command:e,options:t}=await W.execute({args:process.argv}),n;if(t.customConfig)try{let s=url.pathToFileURL(path.resolve(process.cwd(),t.customConfig)).toString();n=await import(s),n=n.default||n,n&&console.log(`\u2728 found custom config at: ${s}`);}catch(s){console.error("Error loading custom config",s);}try{switch(e){case null:{await chunkB7E4I4GW_cjs.g({...t,name:t.name,url:t.path,generateRouteTypes:t.generateRouteTypes,generateClient:!!(t.axios||t.client),httpClientType:t.axios?chunkB7E4I4GW_cjs.b.AXIOS:chunkB7E4I4GW_cjs.b.FETCH,input:path.resolve(process.cwd(),t.path),output:path.resolve(process.cwd(),t.output||"."),...n});break}case"generate-templates":{await chunkB7E4I4GW_cjs.f(t);break}default:break}}catch(s){console.error(s),process.exit(1);}process.exit(0);};K();
//# sourceMappingURL=cli.cjs.map
//# sourceMappingURL=cli.cjs.map